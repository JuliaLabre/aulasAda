import { Repository, RequestHandler, IRouterHandler, IRoute, Router, JsonObject } from 'express';
import { GenericExpressAdapter } from './generic'; // Importe a interface GenericExpressAdapter aqui

export class ServerAdapter implements GenericExpressAdapter {
    private instance: Express;

    constructor(instance: Express) {
        this.instance = instance;
    }

    setGlobalMiddleware(middlewares: Array<RequestHandler<IRouterHandler<IRoute>>>) {
        this.instance.use(middlewares);
    }

    setSwagger(path: string, swaggerUi: any, swaggerFile: JsonObject) {
        this.instance.use(path, swaggerUi.serve, swaggerUi.setup(swaggerFile));
    }

    setRouter(router: Router) {
        this.instance.get('/health', (_, res) => res.send("ok"));
        this.instance.use('/users', router);
    }

    startServer() {
        const PORT = process.env.PORT || 3000;
        this.instance.listen(PORT, () => {
            console.log(`Server is running on http://localhost:${PORT}`);
        });
    }
}
